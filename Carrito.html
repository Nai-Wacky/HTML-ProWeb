<!DOCTYPE html>
<html>
  <head>
    <meta
      charset="utf-8"
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />

    <link rel="stylesheet" href="StyleCarro.css" />

    <title>Carrito</title>

    <link rel="icon" href="images/Any-job-icon.ico" type="image/x-icon" />

    <style></style>
  </head>

  <body style="background-color: ffffff">
    <div class="navbar">
      <!-- Logo Izquierda -->

      <button
        class="buttonImageLogo"
        onclick="window.location.assign('AnyJobHome.html')"
      >
        <img
          src="images/Any Job Imagotipo chiquito.png"
          width="180"
          height="60"
          title="Any job"
        />
      </button>

      <!-- Buscador -->

      <div style="margin: 0 auto" class="search-box">
        <input type="text" placeholder="Herramientas..." />
        <button>
          <img
            src="https://cdn-icons-png.flaticon.com/512/622/622669.png"
            alt="Buscar"
          />
        </button>
      </div>

      <!-- Opciones -->

      <button
        class="buttonOpcion"
        onclick="window.location.assign('Perfil.html')"
      >
        <img
          src="images/navbar/Perfil Any Job.png"
          href=""
          width="28"
          height="33"
          title="Perfil"
        />
        <h3 id="bienvenida" style="color: white">Login</h3>
      </button>

      <button
        class="buttonOpcion"
        onclick="window.location.assign('Categorias.html')"
      >
        <img
          src="images/navbar/Pedidos.png"
          width="50"
          height="50"
          title="Catalogo de proveedores"
        />
      </button>
    </div>

    <!-- Carrito -->

    <div class="carrito-container">
      <!-- Productos en el carrito -->
      <div class="productos">
        <div class="carrito-producto" data-id="1">
          <input type="checkbox" checked />
          <img src="https://i.imgur.com/1.png" alt="Puma RS-X" />
          <div class="producto-info">
            <p class="titulo">Puma RS-X</p>
            <p>Precio unitario: $2350</p>
            <p>Subtotal: <span class="subtotal">4700</span></p>
            <a href="#" class="eliminar" style="color: #e53935">Eliminar</a>
          </div>
          <div class="cantidad">
            <button class="restar">-</button>
            <input type="text" value="2" readonly />
            <button class="sumar">+</button>
          </div>
        </div>
        <div class="carrito-producto" data-id="2">
          <input type="checkbox" checked />
          <img src="https://i.imgur.com/2.png" alt="Adidas Ultraboost" />
          <div class="producto-info">
            <p class="titulo">Adidas Ultraboost</p>
            <p>Precio unitario: $2500</p>
            <p>Subtotal: <span class="subtotal">5000</span></p>
            <a href="#" class="eliminar" style="color: #e53935">Eliminar</a>
          </div>
          <div class="cantidad">
            <button class="restar">-</button>
            <input type="text" value="2" readonly />
            <button class="sumar">+</button>
          </div>
        </div>
      </div>
      <!-- Resumen de compra -->
      <div class="resumen">
        <h3>Resumen de compra</h3>
        <div class="fila">
          <span>Producto</span>
          <span id="resumen-producto">$9700.00</span>
        </div>
        <div class="fila">
          <span>Envío</span>
          <span style="color: green">Gratis</span>
        </div>
        <hr />
        <div class="fila total">
          <span>Total</span>
          <span id="resumen-total">$9700.00</span>
        </div>
        <button class="btn-comprar">Continuar compra</button>
      </div>
    </div>
    <script src="carrito.js"></script>

    <script>
      //----------------------------------------------CARRITO----------------------------------------------
      function actualizarResumen() {
        let total = 0;
        document.querySelectorAll(".carrito-producto").forEach((producto) => {
          const checkbox = producto.querySelector('input[type="checkbox"]');
          if (checkbox.checked) {
            const precioUnitario = parseInt(
              producto
                .querySelector(".producto-info p:nth-child(2)")
                .textContent.replace(/\D/g, "")
            );
            const cantidad = parseInt(
              producto.querySelector(".cantidad input").value
            );
            const subtotal = precioUnitario * cantidad;
            producto.querySelector(".subtotal").textContent = subtotal;
            total += subtotal;
          } else {
            producto.querySelector(".subtotal").textContent = 0;
          }
        });
        document.getElementById(
          "resumen-producto"
        ).textContent = `$${total}.00`;
        document.getElementById("resumen-total").textContent = `$${total}.00`;
      }

      // Eventos para sumar/restar cantidad
      document.querySelectorAll(".carrito-producto").forEach((producto) => {
        const restarBtn = producto.querySelector(".restar");
        const sumarBtn = producto.querySelector(".sumar");
        const cantidadInput = producto.querySelector(".cantidad input");
        const checkbox = producto.querySelector('input[type="checkbox"]');
        const eliminarBtn = producto.querySelector(".eliminar");

        restarBtn.addEventListener("click", () => {
          let cantidad = parseInt(cantidadInput.value);
          if (cantidad > 1) {
            cantidadInput.value = cantidad - 1;
            actualizarResumen();
          }
        });

        sumarBtn.addEventListener("click", () => {
          let cantidad = parseInt(cantidadInput.value);
          cantidadInput.value = cantidad + 1;
          actualizarResumen();
        });

        checkbox.addEventListener("change", actualizarResumen);

        eliminarBtn.addEventListener("click", (e) => {
          e.preventDefault();
          producto.remove();
          actualizarResumen();
        });
      });

      // Inicializar resumen al cargar
      actualizarResumen();

      //----------------------------------------------LOCALSTORAGE----------------------------------------------

      const nombre = localStorage.getItem("nombre");

      window.addEventListener("DOMContentLoaded", () => {
        const nombreGuardado = localStorage.getItem("usuarioNombre");
        if (nombreGuardado) {
          document.getElementById("bienvenida").textContent = nombreGuardado;
        }
      });
    </script>
  </body>
</html>
